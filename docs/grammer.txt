<roll> ::=
	  <explicit_roll>
	| <inline_roll>

<explicit_roll> ::=
	  "/roll" <expression> ["\"]

<inline_roll> ::=
	"[[" <expression> "]]"

<expression> ::=
	  <expression> {("+" | "-") <mul_div>}

<mul_div> ::=
	  <mul_div> {("*" | "/") <power>}

<power> ::=
	  <unary> ("**" | "^") <power>
	| <unary>

<unary> ::=
	  [<inline>] "-" <unary> =
	| <atom>

<atom>
	  [<inline>] <function> [<inline>]
	| [<inline>] <dice> [<inline>]
	| [<inline>] <number> [<inline>]
	| [<inline>] <roll_query> [<inline>]
	| [<inline>] "(" <expression> ")" [<inline>]

<function> ::=
	<fucntion_name> "(" <expression> ")"

<function_name> ::=
	  "abs"
	| "ceil"
	| "floor"
	| "round"

<number> ::=
	  <integer>
	| <float>

<integer> ::=
	{"0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"}-

<float> ::=
	<integer> "." <integer>

<roll_query> ::=
	"?{" <any> ["|" <expression>] "}"

<inline> ::=
	  "[" <any>+ "]"

<dice> ::=
	| (<normal> | <fate> | <computed>) [<modifiers>] [<inline>]

<modifiers> :=
	[<exploding> | <compounding>]
	[(<high> [<low>] | <low> [<high>])]
	[<critical>]
	[<successes>]

<normal> ::=
	[<integer> | <roll_query>] "d" (<integer> | <roll_query>)

<fate> ::=
	([<integer>] | <roll_query>) "dF"

<computed> ::=
	  [    <integer>       ] "d" "(" <expression> ")"
	|  "(" <expression> ")"  "d"     <integer>
	| ["(" <expression> ")"] "d" "(" <expression> ")"

<exploding> ::=
	"!" [[<comparison_operator>] <integer>]

<compounding> ::=
	"!!" [[<comparison_operator>] <integer>]

<high> ::=
	("dh" | "k" | "kh") <integer>

<low> ::=
	("d" | "dl" | "kl") <integer>

<reroll> ::=
	{"r" [<comparison_operator>] (<integer> | <roll_query>)}-

<successes> ::=
	{<comparison_operator> <integer>}-

<critical> ::=
	{("cs" | "cf") [<comparison_operator>] (<integer> | <roll_query>)}-

<comparison_operator> ::=
	  "="
	| "<"
	| "<="
	| ">"
	| ">="